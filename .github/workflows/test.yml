name: Test Notebook Utils

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  test-container:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        
      - name: Build Docker image
        run: |
          echo "Building Docker image..."
          docker build -t spark-notebook-test . || {
            echo "Docker build failed. This might be due to network issues or base image availability."
            echo "Checking if base image exists..."
            docker pull ghcr.io/berdatalakehouse/spark_notebook_base:main || echo "Base image pull failed"
            exit 1
          }
          
      - name: Run container test
        run: |
          echo "Running test inside container..."
          docker run --rm \
            -v $(pwd)/test_container_notebook_utils.py:/test_container_notebook_utils.py \
            spark-notebook-test \
            python /test_container_notebook_utils.py